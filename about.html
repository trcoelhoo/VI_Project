<!DOCTYPE html>
<html lang="en">
   <head>
      <script type="text/javascript" src="http://d3js.org/d3.v6.js"></script>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>Cinemas de Portugal</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- bootstrap css -->
      <link rel="stylesheet" href="css/bootstrap.min.css">
      <!-- style css -->
      <link rel="stylesheet" href="css/style.css">
      <!-- Responsive-->
      <link rel="stylesheet" href="css/responsive.css">
      <!-- fevicon -->
      <link rel="icon" href="images/fevicon.png" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
      <!-- Tweaks for older IEs-->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
   </head>
   <!-- body -->
   <body onload="filterSelection('recintos')" class="main-layout inner_header about_page">
      <!-- loader  -->
      <div class="loader_bg">
         <div class="loader"><img src="images/loading.gif" alt="#" /></div>
      </div>
      <!-- end loader -->
      <!-- header -->
      <header>
         <!-- header inner -->
         <div class="header">
            <div class="container">
               <div class="row">
                  <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col logo_section">
                     <div class="full">
                        <div class="center-desk">
                           <div class="logo">
                              <a href="index.html"><img src="images/logo.png" alt="#" /></a>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9">
                     <nav class="navigation navbar navbar-expand-md navbar-dark ">
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarsExample04">
                           <ul class="navbar-nav mr-auto">
                              <li class="nav-item ">
                                 <a class="nav-link" href="index.html">Home</a>
                              </li>
                              <li class="nav-item active">
                                 <a class="nav-link" href="about.html">Regiões</a>
                              </li>
                              <li class="nav-item">
                                 <a class="nav-link" href="blog.html">Portugal</a>
                              </li>
                              <li class="nav-item">
                                 <a class="nav-link" href="contact.html">Filmes</a>
                              </li>
                           </ul>
                        </div>
                     </nav>
                  </div>
               </div>
            </div>
         </div>
      </header>
      <!-- end header inner -->
      <!-- end header -->
     <div class="yellow_darkbg">
        <div class="container">
           <div class="row">
              <div class="col-md-12">
                 <div class="titlepage">
                  <h2>Dados relativos às regiões</h2>
                 </div>
              </div>
           </div>
        </div>
     </div>


      <!-- team -->
      <div class="team">
         <div class="container">
            <div class="row d_flex">
              
               <div class="col-md-6">
                  <div id="my_dataviz">
                     <div id="tooltip"></div>
                  </div>
               </div>
                <div class="col-md-4 offset-md-2">
                  
                      <h3>Opções: </h3>
                  <!--6 buttons to filter the data-->
                  
                    <div class="col-md-6">
                      <button class="read_more" onclick="filterSelection('recintos')"> Recintos</button>
                      <!-- give space between buttons -->
                        <br>
                        <br> 
                    </div>
                    <div class="col-md-6">
                      <button class="read_more" onclick="filterSelection('ecras')"> Ecrâs</button>
                      <!-- give space between buttons -->
                      <br>
                      <br> 
                    </div>
                    <div class="col-md-6">
                      <button class="read_more" onclick="filterSelection('espectadores')"> Espectadores</button>
                      <!-- give space between buttons -->
                      <br>
                      <br> 
                    </div>
                    <div class="col-md-6">
                      <button class="read_more" onclick="filterSelection('lotacao')"> Lotação</button>
                      <!-- give space between buttons -->
                      <br>
                      <br> 
                    </div>
                    <div class="col-md-6">
                      <button class="read_more" onclick="filterSelection('receitas')"> Receitas </button>
                      <!-- give space between buttons -->
                      <br>
                      <br> 
                    </div>
                    <div class="col-md-6">
                      <button class="read_more" onclick="filterSelection('sessoes')"> Sessões </button>
                      <!-- give space between buttons -->
                      <br>
                      <br> 
                      <br>
                      <br>

                    </div>
                  
            </div>
         </div>
         

      </div>
         <!-- team -->
        
       <!-- footer -->
      <footer>
         
         <div class="footer">
            <div class="container">
               <div class="row">
                  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                     <img class="logo1" src="images/logo1.png" alt="#"/>
                     <ul class="about_us">
                        <li>Todos os dados<br> presentes<br>foram retirados <br> da PORDATA</li>
                     </ul>
                     <ul class="social_icon">
                        <li><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-linkedin-square" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
                     </ul>
                  </div>
                  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                     <h3>Useful Link</h3>
                     <ul class="link_menu">
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">About services</a></li>
                        <li><a href="#">About Departments</a></li>
                        <li><a href="#">Services</a></li>
                        <li><a href="#">Contact Us</a></li>
                     </ul>
                  </div>
                  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                     <h3>The Services</h3>
                     <ul class="link_menu">
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">About services</a></li>
                        <li><a href="#">About Departments</a></li>
                        <li><a href="#">Services</a></li>
                        <li><a href="#">Contact Us</a></li>
                     </ul>
                  </div>
                  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                     <h3>Contact Us</h3>
                     <ul class="link_menu">
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">About services</a></li>
                        <li><a href="#">About Departments</a></li>
                        <li><a href="#">Services</a></li>
                        <li><a href="#">Contact Us</a></li>
                     </ul>
                  </div>

               </div>
            </div>

         </div>
      </footer>
      <!-- end footer -->
      <!-- Javascript files-->
      <script>
         function getLegend(escolha) {
           if (escolha == "recintos") {
             return "Número de recintos";
           } else if (escolha == "ecras") {
             return "Número de ecrãs";
           } else if (escolha == "espectadores") {
             return "Número de espectadores";
           } else if (escolha == "lotacao") {
             return "Lotação";
           } else if (escolha == "receitas") {
             return "Receitas";
           } else if (escolha == "sessoes") {
             return "Número de sessões";
           }
         }
         function getSubarray(array, fromIndex, toIndex) {
            return array.slice(fromIndex, toIndex+1);
         }
         function filterSelection(escolha){
            if (escolha =='ecras'){
               path= "../datasets/Municipios/NUTSII_Ecras.csv";
            }else if (escolha =='espectadores'){
               path= "../datasets/Municipios/NUTSII_Espectadores.csv";
            }else if (escolha =='lotacao'){
               path= "../datasets/Municipios/NUTSII_lotacao.csv";
            }else if (escolha =='receitas'){
               path= "../datasets/Municipios/NUTSII_receitas.csv";            
            }else if (escolha =='recintos'){
               path= "../datasets/Municipios/NUTSII_recintos.csv";
            }else if (escolha =='sessoes'){
               path= "../datasets/Municipios/NUTSII_sessoes.csv";    
            }           
            d3.selectAll("svg").remove();
            // set the dimensions and margins of the graph
            const margin = {top: 20, right: 30, bottom: 60, left: 180},
               width = 660 - margin.left - margin.right,
               height = 600 - margin.top - margin.bottom;
            
            // append the svg object to the body of the page
            const svg = d3.select("#my_dataviz")
            .append("svg")
               .attr("width", width + margin.left + margin.right+100)
               .attr("height", height + margin.top + margin.bottom+100)
            .append("g")
               .attr("transform", `translate(${margin.left}, ${margin.top})`);
            
            // Parse the Data
            d3.csv(path).then( function(data) {
               // bar chart with regions on y axis
               //for each region, display 5 bars corresponding to the 5 years

               // display y axis line with region names
               const y = d3.scaleBand()
                  .domain(data.map(d => d.Região))
                  .range([height, 0])
                  .padding(0.1);
               svg.append("g")
                  .call(d3.axisLeft(y))
                  .selectAll("text")
                  .attr("transform", "translate(-10,0)")
                  .style("text-anchor", "end");
               //when click on region name, chnage the data displayed
               d3.selectAll("g.tick").on("click", function(d) {
                  //get the region name
                  const region = d3.select(this).text();
                  filterSelectionRegion(escolha, region);
                  return;
                  
                  
               });
               // x axis with number of cinemas
               // get all the years to get the max
               const years = data.columns.slice(3);
               //get all the values for the max
               const values = data.map(d => d3.max(years, year => parseInt(d[year])));
               const x = d3.scaleLinear()
                  .domain([0, d3.max(values)])
                  .range([0, width]);
               svg.append("g")
                  .attr("transform", `translate(0, ${height})`)
                  .call(d3.axisBottom(x).ticks(5).tickSizeOuter(0))
                  .selectAll("text")
                  .attr("font-size", "12px")
                  .attr("font-weight", "bold")
                  .attr("fill", "black")
                  .attr("text-anchor", "end")
                  .attr("dx", "-0.8em")
                  .attr("dy", "0.15em")
                  .attr("transform", "rotate(-65)");
               svg.append("text")
                  .attr("text-anchor", "end")
                  .attr("x", width)
                  .attr("y", height + margin.top + 60)
                  .text(getLegend(escolha))
                  .attr("font-size", "12px")
                  .attr("font-weight", "bold")
                  .attr("fill", "black");

               
               //color palette
               const color = d3.scaleOrdinal()
                  .domain(years)
                  .range(d3.schemeSet1);


               // put the bars horizontally
               // bar for each year (5 bars per region)
               svg.append("g")
                  .selectAll("g")
                  // Enter in data = loop group per group
                  .data(data)
                  .enter()
                  .append("g")
                  .attr("transform", d => `translate(0, ${y(d.Região)})`)
                  .selectAll("rect")
                  // enter a second time = loop subgroup per subgroup to add all rectangles
                  .data(d => years.map(year => ({year, value: d[year]})))
                  .enter()
                  .append("rect")
                  .attr("x", d => x(0))
                  .attr("y", (d, i) => i *13)
                  .attr("width", d => x(d.value))
                  .attr("height", y.bandwidth() / 5)
                  //fill with corresponding color for each year
                  .attr("fill", d => color(d.year))
                  .attr("stroke", "black")
                  .attr("stroke-width", "0.5px")
                  //on mouseover, display the year and the number of cinemas
                  .on("mouseover", function(d) {
                     d3.select(this)
                        .attr("stroke", "black")
                        .attr("stroke-width", "2px");
                     d3.select(this)
                        .append("title")
                        .text("Ano "+this.__data__.year + ": " + this.__data__.value);

                  })
                  .on("mouseout", function(d) {
                     d3.select(this)
                        .attr("stroke", "black")
                        .attr("stroke-width", "0.5px");
                     d3.select("#tooltip").style("display", "none");
                  });


               // add the legend
               const legend = svg.append("g")
                  .attr("font-family", "sans-serif")
                  .attr("font-size", 10)
                  .attr("text-anchor", "end")
                  .selectAll("g")
                  .data(years.slice())
                  .enter()
                  .append("g")
                  .attr("transform", (d, i) => `translate(0, ${i * 20})`);

               legend.append("rect")
                  .attr("x", width +30)
                  .attr("width", 19)
                  .attr("height", 19)
                  .attr("fill", color)
                  .attr("stroke", "black")
                  .attr("stroke-width", "0.5px");

               legend.append("text")
                  .attr("x", width +25)
                  .attr("y", 9.5)
                  .attr("dy", "0.32em")
                  .text(d => d);

               //add title
               svg.append("text")
                  .attr("x", (width / 2))             
                  .attr("y", 0 - (margin.top / 2))
                  .attr("text-anchor", "middle")  
                  .style("font-size", "16px") 
                  .style("text-decoration", "underline")  
                  .text(getTitle(escolha));




            });
               
         }
         function getTitle(escolha){
            if(escolha=="recintos"){
               return "Número de recintos por região";
            }
            else if(escolha=="ecras"){
               return "Número de ecrãs por região";
            }
            else if(escolha=="espectadores"){
               return "Número de espectadores por região";
            }
            else if(escolha=="sessoes"){
               return "Número de sessões por região";
            }
            else if(escolha=="receitas"){
               return "Receitas por região";
            }
            else if (escolha=="lotacao"){
               return "Lotação por região";
            }
         }
         
         
         function filterSelectionRegion(escolha,regiao){
            if (escolha =='ecras'){
               path= "../datasets/Municipios/NUTSIII_Ecras.csv";
            }else if (escolha =='espectadores'){
               path= "../datasets/Municipios/NUTSIII_Espectadores.csv";
            }else if (escolha =='lotacao'){
               path= "../datasets/Municipios/NUTSIII_lotacao.csv";
            }else if (escolha =='receitas'){
               path= "../datasets/Municipios/NUTSIII_receitas.csv";
            }else if (escolha =='recintos'){
               path= "../datasets/Municipios/NUTSIII_recintos.csv";
            }else if (escolha =='sessoes'){
               path= "../datasets/Municipios/NUTSIII_sessoes.csv";
            }
            d3.selectAll("svg").remove();
            // set the dimensions and margins of the graph
            const margin = {top: 20, right: 30, bottom: 60, left: 180},
               width = 660 - margin.left - margin.right,
               height = 600 - margin.top - margin.bottom;
            
            // append the svg object to the body of the page
            const svg = d3.select("#my_dataviz")
            .append("svg")
               .attr("width", width + margin.left + margin.right+100)
               .attr("height", height + margin.top + margin.bottom+100)
            .append("g")
               .attr("transform", `translate(${margin.left}, ${margin.top})`);
            

            d3.csv(path).then( function(data) {
               //get the data for the region
               if (regiao!=""){
                  if (regiao=="Norte"){
                     data = getSubarray(data,0,7);
                     console.log(data);
                  }
                  else if (regiao=="Centro"){
                     data = getSubarray(data,8,15);
                     console.log(data);
                  }
                  else if (regiao=="Área Metropolitana de Lisboa"){
                     data = getSubarray(data,16,16);
                     console.log(data);
                  }
                  else if (regiao=="Alentejo"){
                     data = getSubarray(data,17,21);
                     console.log(data);
                  }
                  else if (regiao=="Algarve"){
                     data = getSubarray(data,22,22);
                     console.log(data);
                  }
                  else if (regiao=="Região Autónoma dos Açores"){
                     data = getSubarray(data,23,31);
                     console.log(data);
                  }
                  else if (regiao=="Região Autónoma da Madeira"){
                     data = getSubarray(data,32,33);
                     console.log(data);
                  }
                     
               }
               var regions= data.length;
               console.log(regions);
               const y = d3.scaleBand()
                  .domain(data.map(d => d.Região))
                  .range([height, 0])
                  .padding(0.1);
               svg.append("g")
                  .call(d3.axisLeft(y))
                  .selectAll("text")
                  .attr("transform", "translate(-10,0)")
                  .style("text-anchor", "end");
               
               var years = ["2017", "2018", "2019", "2020", "2021"];
               const values = data.map(d => d3.max(years, year => parseInt(d[year])));
               console.log(values);
               const x = d3.scaleLinear()
                  .domain([0, d3.max(values)])
                  .range([0, width]);

               svg.append("g")
                  .attr("transform", `translate(0, ${height})`)
                  .call(d3.axisBottom(x).ticks(5).tickSizeOuter(0))
                  .selectAll("text")
                  .attr("font-size", "12px")
                  .attr("font-weight", "bold")
                  .attr("fill", "black")
                  .attr("text-anchor", "end")
                  .attr("dx", "-0.8em")
                  .attr("dy", "0.15em")
                  .attr("transform", "rotate(-65)");
               svg.append("text")
                  .attr("text-anchor", "end")
                  .attr("x", width)
                  .attr("y", height + margin.top + 60)
                  .text(getLegend(escolha))
                  .attr("font-size", "12px")
                  .attr("font-weight", "bold")
                  .attr("fill", "black");

               const color = d3.scaleOrdinal()
                  .domain(years)
                  .range(d3.schemeSet2);
               function getConstant(regions){
                  if (regions==1){
                     return 90;
                  }
                  else if(regions==2){
                     return 50;
                  }else if(regions==9){
                     return 10;
                  }else if(regions==5){
                     return 19;
                  }else if(regions==8){
                     return 12;
                  }
               }
               // put the bars horizontally
               // bar for each year (5 bars per region)
               svg.append("g")
                  .selectAll("g")
                  // Enter in data = loop group per group
                  .data(data)
                  .enter()
                  .append("g")
                     .attr("transform", d => `translate(0, ${y(d.Região)})`)
                     .selectAll("rect")
                     // enter a second time = loop subgroup per subgroup to add all rectangles
                     .data(d => years.map(year => ({year, value: parseInt(d[year])})))
                     .enter()
                     .append("rect")
                        .attr("x", d => x(0))
                        .attr("y", (d, i) => i * getConstant(regions))
                        .attr("width", d => x(d.value))
                        .attr("height", y.bandwidth() / 5)
                        .attr("fill", d => color(d.year))
                        .attr("stroke", "black")
                        .attr("stroke-width", "0.5px")
                        .on("mouseover", function(d) {
                           d3.select(this)
                              .attr("stroke", "black")
                              .attr("stroke-width", "2px");
                           d3.select(this)
                              .append("title")
                              .text("Ano "+this.__data__.year + ": " + this.__data__.value);

                        })
                        .on("mouseout", function(d) {
                           d3.select(this)
                              .attr("stroke", "black")
                              .attr("stroke-width", "0.5px");
                           d3.select("#tooltip").style("display", "none");
                        });

               // add the legend
               const legend = svg.append("g")
                  .attr("font-family", "sans-serif")
                  .attr("font-size", 10)
                  .attr("text-anchor", "end")
                  .selectAll("g")
                  .data(years.slice())
                  .enter()
                  .append("g")
                  .attr("transform", (d, i) => `translate(0, ${i * 20})`);

               legend.append("rect")
                  .attr("x", width + 30)
                  .attr("width", 19)
                  .attr("height", 19)
                  .attr("fill", color)
                  .attr("stroke", "black")
                  .attr("stroke-width", "0.5px");

               legend.append("text")
                  .attr("x", width + 25)
                  .attr("y", 9.5)
                  .attr("dy", "0.32em")
                  .text(d => d);

               // add the title
               svg.append("text")
                  .attr("x", (width / 2))
                  .attr("y", 0 - (margin.top / 2))
                  .attr("text-anchor", "middle")
                  .style("font-size", "16px")
                  .style("text-decoration", "underline")
                  .text(getTitle(escolha, regiao));
               


               
               
            });

            function getTitle(escolha,regiao){
               if (escolha=="recintos"){
                  return "Número de recintos em "+regiao;
               }
               else if (escolha=="ecras"){
                  return "Número de ecrãs em "+regiao;
               }else if (escolha=="espectadores"){
                  return "Número de espectadores em "+regiao;
               }
               else if (escolha=="receitas"){
                  return "Receitas em "+regiao;
               }
               else if (escolha=="lotacao"){
                  return "Lotação em "+regiao;
               }
               else if (escolha=="sessoes"){
                  return "Número de sessões em "+regiao;
               }
            }
               

         }
         </script>
      <script src="js/jquery.min.js"></script>
      <script src="js/barchart_csv.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.bundle.min.js"></script>
      <script src="js/jquery-3.0.0.min.js"></script>
      <!-- sidebar -->
      <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
      <script src="js/custom.js"></script>
   </body>
</html>

