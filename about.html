<!DOCTYPE html>
<html lang="en">
   <head>
      <script type="text/javascript" src="http://d3js.org/d3.v6.js"></script>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>Cinemas de Portugal</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- bootstrap css -->
      <link rel="stylesheet" href="css/bootstrap.min.css">
      <!-- style css -->
      <link rel="stylesheet" href="css/style.css">
      <!-- Responsive-->
      <link rel="stylesheet" href="css/responsive.css">
      <!-- fevicon -->
      <link rel="icon" href="images/fevicon.png" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
      <!-- Tweaks for older IEs-->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
   </head>
   <!-- body -->
   <body onload="filterSelection('recintos')" class="main-layout inner_header about_page">
      <!-- loader  -->
      <div class="loader_bg">
         <div class="loader"><img src="images/loading.gif" alt="#" /></div>
      </div>
      <!-- end loader -->
      <!-- header -->
      <header>
         <!-- header inner -->
         <div class="header">
            <div class="container">
               <div class="row">
                  <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col logo_section">
                     <div class="full">
                        <div class="center-desk">
                           <div class="logo">
                              <a href="index.html"><img src="images/logo.png" alt="#" /></a>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9">
                     <nav class="navigation navbar navbar-expand-md navbar-dark ">
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarsExample04">
                           <ul class="navbar-nav mr-auto">
                              <li class="nav-item ">
                                 <a class="nav-link" href="index.html">Home</a>
                              </li>
                              <li class="nav-item active">
                                 <a class="nav-link" href="about.html">Regiões</a>
                              </li>
                              <li class="nav-item">
                                 <a class="nav-link" href="blog.html">Portugal</a>
                              </li>
                           </ul>
                        </div>
                     </nav>
                  </div>
               </div>
            </div>
         </div>
      </header>
      <!-- end header inner -->
      <!-- end header -->
     <div class="yellow_darkbg">
        <div class="container">
           <div class="row">
              <div class="col-md-12">
                 <div class="titlepage">
                  <h2>Dados relativos às regiões</h2>
                 </div>
              </div>
           </div>
        </div>
     </div>


      <!-- team -->
      <div class="team">
         <div class="container">
            <div class="row d_flex">
              
               <div class="col-md-6">
                  <div id="my_dataviz"></div>
               </div>
                <div class="col-md-4 offset-md-2">
                  
                      <h3>Opções: </h3>
                  <!--6 buttons to filter the data-->
                  
                    <div class="col-md-6">
                      <button class="read_more" onclick="filterSelection('recintos')"> Recintos</button>
                      <!-- give space between buttons -->
                        <br>
                        <br> 
                    </div>
                    <div class="col-md-6">
                      <button class="read_more" onclick="filterSelection('ecras')"> Ecrâs</button>
                      <!-- give space between buttons -->
                      <br>
                      <br> 
                    </div>
                    <div class="col-md-6">
                      <button class="read_more" onclick="filterSelection('espectadores')"> Espectadores</button>
                      <!-- give space between buttons -->
                      <br>
                      <br> 
                    </div>
                    <div class="col-md-6">
                      <button class="read_more" onclick="filterSelection('lotacao')"> Lotação</button>
                      <!-- give space between buttons -->
                      <br>
                      <br> 
                    </div>
                    <div class="col-md-6">
                      <button class="read_more" onclick="filterSelection('receitas')"> Receitas </button>
                      <!-- give space between buttons -->
                      <br>
                      <br> 
                    </div>
                    <div class="col-md-6">
                      <button class="read_more" onclick="filterSelection('sessoes')"> Sessões </button>
                      <!-- give space between buttons -->
                      <br>
                      <br> 
                      <br>
                      <br>

                    </div>
                  
            </div>
         </div>
         

      </div>
         <!-- team -->
        
       <!-- footer -->
      <footer>
         
         <div class="footer">
            <div class="container">
               <div class="row">
                  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                     <img class="logo1" src="images/logo1.png" alt="#"/>
                     <ul class="about_us">
                        <li>Todos os dados<br> presentes<br>foram retirados <br> da PORDATA</li>
                     </ul>
                     <ul class="social_icon">
                        <li><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-linkedin-square" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
                     </ul>
                  </div>
                  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                     <h3>Useful Link</h3>
                     <ul class="link_menu">
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">About services</a></li>
                        <li><a href="#">About Departments</a></li>
                        <li><a href="#">Services</a></li>
                        <li><a href="#">Contact Us</a></li>
                     </ul>
                  </div>
                  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                     <h3>The Services</h3>
                     <ul class="link_menu">
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">About services</a></li>
                        <li><a href="#">About Departments</a></li>
                        <li><a href="#">Services</a></li>
                        <li><a href="#">Contact Us</a></li>
                     </ul>
                  </div>
                  <div class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                     <h3>Contact Us</h3>
                     <ul class="link_menu">
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">About services</a></li>
                        <li><a href="#">About Departments</a></li>
                        <li><a href="#">Services</a></li>
                        <li><a href="#">Contact Us</a></li>
                     </ul>
                  </div>

               </div>
            </div>

         </div>
      </footer>
      <!-- end footer -->
      <!-- Javascript files-->
      <script>
         function getSubarray(array, fromIndex, toIndex) {
            return array.slice(fromIndex, toIndex+1);
         }
         function filterSelection(escolha){
            if (escolha =='ecras'){
               path= "../datasets/Municipios/NUTSII_Ecras.csv";
            }else if (escolha =='espectadores'){
               path= "../datasets/Municipios/NUTSII_Espectadores.csv";
            }else if (escolha =='lotacao'){
               path= "../datasets/Municipios/NUTSII_lotacao.csv";
            }else if (escolha =='receitas'){
               path= "../datasets/Municipios/NUTSII_receitas.csv";            
            }else if (escolha =='recintos'){
               path= "../datasets/Municipios/NUTSII_recintos.csv";
            }else if (escolha =='sessoes'){
               path= "../datasets/Municipios/NUTSII_sessoes.csv";    
            }           
            d3.selectAll("svg").remove();
            // set the dimensions and margins of the graph
            const margin = {top: 20, right: 30, bottom: 60, left: 180},
               width = 560 - margin.left - margin.right,
               height = 500 - margin.top - margin.bottom;
            
            // append the svg object to the body of the page
            const svg = d3.select("#my_dataviz")
            .append("svg")
               .attr("width", width + margin.left + margin.right)
               .attr("height", height + margin.top + margin.bottom)
            .append("g")
               .attr("transform", `translate(${margin.left}, ${margin.top})`);
            
            // Parse the Data
            d3.csv(path).then( function(data) {
               var subgroups = data.columns.slice(1);
               subgroups= getSubarray(subgroups, 2, 6);
               //console.log(data);
               var vals=[];
               for (var i=0;i<data.length;i++){
                  vals.push(parseInt(data[i][2017]));
               }
               var anos=['2017','2018','2019','2020','2021'];

               var x = d3.scaleLinear()
                  .domain([0,d3.max(vals)])
                  .range([ 0, width]);
               svg.append("g")
                  .attr("transform", `translate(0, ${height})`)
                  .call(d3.axisBottom(x))
                  .selectAll("text")
                     .attr("transform", "translate(-10,0)rotate(-45)")
                     .style("text-anchor", "end");
               
                     
               // Y axis
               var y = d3.scaleBand()
                  .range([ 0, height ])
                  .domain(data.map(d => d.Região))
                  .padding(.1);
               svg.append("g")
                  .call(d3.axisLeft(y));
               

               var ySubgroup = d3.scaleBand()
                     .domain(subgroups)
                     .range([0,y.bandwidth()])
                     .padding([0.05]);
               
               var color = d3.scaleOrdinal()
                  .domain(subgroups)
                  .range(['#e41a1c','#377eb8','#4daf4a','#69b3a2','#69b4c2']);
               //Bars
               svg.append("g")
                  .selectAll("g")
                  // Enter in data = loop group per group
                  .data(data)
                  .enter()
                  .append("g")
                     .attr("transform", function(d) { console.log(d.Região); return "translate(" + y(d.Região) + ",0)"; })
                  .selectAll("rect")
                  .data(function(d) { return subgroups.map(function(key) {return {key: key, value: d[key]}; }); })
                  .enter().append("rect")  
                     .attr("y", d=>ySubgroup(d.key))
                     .attr("width", d=>height - x(d.value))
                     .attr("height", ySubgroup.bandwidth())
                     .attr("fill", d=>color(d.key));
               //console.log(data.columns.slice(1))
               //console.log(data.length)
               // Add X axis

               // var groups = d3.map(data, function(d){return(d.Região)}).keys()

               // // Add X axis
               // var x = d3.scaleBand()
               //       .domain(groups)
               //       .range([0, width])
               //       .padding([0.2])
               // svg.append("g")
               //    .attr("transform", "translate(0," + height + ")")
               //    .call(d3.axisBottom(x).tickSize(0));

               // // Add Y axis
               // var y = d3.scaleLinear()
               //    .domain([0, d3.max(vals)+vals[0]])
               //    .range([ height, 0 ]);
               // svg.append("g")
               //    .call(d3.axisLeft(y));

               // // Another scale for subgroup position?
               // var xSubgroup = d3.scaleBand()
               //    .domain(subgroups)
               //    .range([0, x.bandwidth()])
               //    .padding([0.05])

               // // color palette = one color per subgroup
               // var color = d3.scaleOrdinal()
               //    .domain(subgroups)
               //    .range(['#e41a1c','#377eb8','#4daf4a','#69b3a2','#13b4c2']);

               // // Show the bars
               // svg.append("g")
               //    .selectAll("g")
               //    // Enter in data = loop group per group
               //    .data(data)
               //    .enter()
               //    .append("g")
               //       .attr("transform", function(d) { return "translate(" + x(d.Região) + ",0)"; })
               //    .selectAll("rect")
               //    .data(function(d) { return subgroups.map(function(key) { return {key: key, value: d[key]}; }); })
               //    .enter().append("rect")
               //       .attr("x",d=>(d.key))   
               //    //.attr("y", d => y(d.key))
               //       .attr("width", d=>y(d.values))
               //       .attr("height", xSubgroup.bandwidth())
               //       .attr("fill", function(d) { return color(d.key); });
                     // .attr("x", function(d) { return xSubgroup(d.value); })
                     // .attr("y", function(d) { return y(d.Região); })
                     // .attr("width", xSubgroup.bandwidth())
                     // .attr("height", function(d) { return x(d.value); })
                     // .attr("fill", function(d) { return color(d.key); });

               
               //-----------------------------------------------------------------------------



               // svg.selectAll("myRect")
               //    .data(data)
               //    .join("rect")
               //    .attr("y", d => y(d.Região))
               //    .attr("width", function(d){
               //       //console.log(x(d[2017]));
               //       console.log(d);
               //       return x(d);
               //    })
               //    .attr("height", y.bandwidth())
               //    .attr("fill", "#69b3a2");
            
            })

            // var margin = {top: 10, right: 30, bottom: 20, left: 50},
            // width = 460 - margin.left - margin.right,
            // height = 400 - margin.top - margin.bottom;

            // // append the svg object to the body of the page
            // var svg = d3.select("#my_dataviz")
            // .append("svg")
            //    .attr("width", width + margin.left + margin.right)
            //    .attr("height", height + margin.top + margin.bottom)
            // .append("g")
            //    .attr("transform",
            //          "translate(" + margin.left + "," + margin.top + ")");

            // // Parse the Data
            // d3.csv("../datasets/Municipios/NUTSII_Ecras.csv", function(data) {

            // // List of subgroups = header of the csv files = soil condition here
            // var subgroups = data.columns.slice(1)

            // // List of groups = species here = value of the first column called group -> I show them on the X axis
            // var groups = d3.map(data, function(d){return(d.Região)}).keys()

            // // Add X axis
            // var x = d3.scaleBand()
            //       .domain(groups)
            //       .range([0, width])
            //       .padding([0.2])
            // svg.append("g")
            //    .attr("transform", "translate(0," + height + ")")
            //    .call(d3.axisBottom(x).tickSize(0));

            // // Add Y axis
            // var y = d3.scaleLinear()
            //    .domain([0, 40])
            //    .range([ height, 0 ]);
            // svg.append("g")
            //    .call(d3.axisLeft(y));

            // // Another scale for subgroup position?
            // var xSubgroup = d3.scaleBand()
            //    .domain(subgroups)
            //    .range([0, x.bandwidth()])
            //    .padding([0.05])

            // // color palette = one color per subgroup
            // var color = d3.scaleOrdinal()
            //    .domain(subgroups)
            //    .range(['#e41a1c','#377eb8','#4daf4a'])

            // // Show the bars
            // svg.append("g")
            //    .selectAll("g")
            //    // Enter in data = loop group per group
            //    .data(data)
            //    .enter()
            //    .append("g")
            //       .attr("transform", function(d) { return "translate(" + x(d.Região) + ",0)"; })
            //    .selectAll("rect")
            //    .data(function(d) { return subgroups.map(function(key) { return {key: key, value: d[key]}; }); })
            //    .enter().append("rect")
            //       .attr("x", function(d) { return xSubgroup(d.key); })
            //       .attr("y", function(d) { return y(d.value); })
            //       .attr("width", xSubgroup.bandwidth())
            //       .attr("height", function(d) { return height - y(d.value); })
            //       .attr("fill", function(d) { return color(d.key); });

            // })
         }
         </script>
      <script src="js/jquery.min.js"></script>
      <script src="js/barchart_csv.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.bundle.min.js"></script>
      <script src="js/jquery-3.0.0.min.js"></script>
      <!-- sidebar -->
      <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
      <script src="js/custom.js"></script>
   </body>
</html>

